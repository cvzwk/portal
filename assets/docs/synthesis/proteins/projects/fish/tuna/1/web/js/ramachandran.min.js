function colourRama(){if($("#rama_chart").data("chartData")){var a=$("path[id^=rama_]").toArray();for(let t=0;t<a.length;t++){var e=a[t].getAttribute("id").split("_");if(e[1]&&e[2])for(var r in chainMapping.structures)"reference"===r||r.endsWith(".dna")||(r=chainMapping.structures[r][e[1]][parseInt(e[2])].rgb,a[t].setAttribute("fill",r?"rgb("+r+")":"white"))}}}!function(_){var x,a={init:function(y){return this.each(function(){var t=_(this),e={allShapes:{},residues:y.residues,chartType:y.chartType,struc_id:y.struc_id,chain:y.chain,imgBaseURL:y.imgBaseURL},a=(t.data("chartData",e),x=null,t.data("chartData")),r=t.width(),i=t.width(),s=(t.empty(),40),n=12,p=(a.paper=Raphael(t.attr("id"),r,i),i-40-n),c=r-s-15,h=a.imgBaseURL;switch(a.chartType){case"glycine":h+="gly.png";break;case"proline":h+="pro.png";break;case"preproline":h+="prepro.png";break;default:h+="full.png"}a.paper.rect(0,0,r,i).attr({fill:"#FFF",stroke:"#FFF"}),a.paper.image(h,s,n,c,p);for(var o,d=c/2+s,u=p/2+n,t=(a.paper.path("M40,"+(n+p/2)+"L"+(s+c)+","+(n+p/2)+"M"+(s+c/2)+","+n+"L"+(s+c/2)+","+(n+p)).attr({stroke:"rgba(70,70,70,.6)","stroke-width":.8,"stroke-dasharray":"- "}),a.paper.set()),r=a.paper.set(),i=a.paper.set(),l=(t.push(a.paper.text(c/2+s,p+n+28,"Φ")),i.push(a.paper.text(s,p+n+12,"-180°")),i.push(a.paper.text(c/2+s,p+n+12,"0°")),i.push(a.paper.text(c+s,p+n+12,"180°")),t.push(a.paper.text(12,p/2+n,"Ψ")),r.push(a.paper.text(36,n,"180°")),r.push(a.paper.text(36,p/2+n,"0°")),r.push(a.paper.text(36,p+n,"-180°")),t.attr({"text-anchor":"middle","font-size":24,"font-family":"Comic sans"}),r.attr({"text-anchor":"end","font-size":12,"font-family":"Comic sans"}),i.attr({"text-anchor":"middle","font-size":12,"font-family":"Comic sans"}),st=a.paper.set(),c/110),g=!1,f=0;f<a.residues.length;f++)if(0!=a.length&&-1!=a.chain.indexOf(a.residues[f][0])&&null!=a.residues[f][4]&&null!=a.residues[f][5]&&(d=(a.residues[f][4]+180)*(c/360)+s,u=(180-a.residues[f][5])*(p/360)+n,!("glycine"==a.chartType&&"GLY"!=a.residues[f][3]||"proline"==a.chartType&&"PRO"!=a.residues[f][3]||"preproline"==a.chartType&&f<a.residues.length-1&&"PRO"!=a.residues[f+1][3]||"glycine"!=a.chartType&&"GLY"==a.residues[f][3]||"general"==a.chartType&&"PRO"==a.residues[f][3]))){for(var m in(o=a.paper.path(a.paper.circlePath(d,u,l))).cx=o.getBBox().x+o.getBBox().width/2,o.cy=o.getBBox().y+o.getBBox().height/2,o.node.id="rama_"+a.residues[f][0]+"_"+a.residues[f][1],chainMapping.structures)"reference"===m||m.endsWith(".dna")||((m=chainMapping.structures[m][a.residues[f][0]][a.residues[f][1]].rgb)?(g=!0,o.attr("fill","rgb("+m+")")):o.attr("fill","white"));a.allShapes[o.node.id]=o,st.push(o)}g?st.attr({stroke:"#333",opacity:".9"}):st.attr({stroke:"#333",opacity:".9",fill:"#fff"}),_("body").on("highlightResidue",function(t,a){"rama"!=a.src&&(x&&x.attr({stroke:"#333","stroke-width":1}),(a=e.allShapes["rama_"+a.chain+"_"+a.resno])&&(a.attr({stroke:"#F00","stroke-width":4}),a.toFront()),x=a)})})}};Raphael.fn.circlePath=function(t,a,e){return"M"+t+","+(a-e)+"A"+e+","+e+",0,1,1,"+(t-.1)+","+(a-e)+" z"},_.fn.ramachandran=function(t){return a[t]?a[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?void _.error("Method "+t+" does not exist on ramachandran.js"):a.init.apply(this,arguments)},_("#rama_chart").on("mouseenter","[id^=rama_]",function(){for(var a,t=_(this).attr("id").split("_"),e=t[1],r=t[2],i=_("#rama_chart").data("chartData"),s=0;s<i.residues.length&&(i.residues[s][1]!=r||i.residues[s][0]!=e);s++);let n=i.residues[s]?e+" "+r+" "+i.residues[s][3]+"; Φ "+i.residues[s][4].toFixed(2)+"; Ψ "+i.residues[s][5].toFixed(2):"MISSING DATA!!";for(let t=0;t<chainMapping.annotations.length;t++)chainMapping.annotations[t].active&&chainMapping.structures[i.struc_id][e]&&chainMapping.structures[i.struc_id][e][r][chainMapping.annotations[t].key]&&(a=chainMapping.structures[i.struc_id][e][r][chainMapping.annotations[t].key],n+="\n"+chainMapping.annotations[t].label+": "+("number"==typeof a?a.toFixed("ramachandran"==chainMapping.annotations[t].key?4:2):a));n=n.replaceAll(/&sigma;/g,"σ"),_("#rama_chart").attr("title",n),x&&x.attr({stroke:"#333","stroke-width":1}),_(this).attr({stroke:"#F00","stroke-width":4}),x=_(this),_("body").trigger("highlightResidue",{src:"rama",struc_id:i.struc_id,chain:t[1],resno:parseInt(t[2])})}),_("#rama_chart").on("mousedown","[id^=rama]",function(){var t=_(this).attr("id").split("_"),a=t[1],t=parseInt(t[2]);_("body").trigger("centerResRange",{src:"rama",struc_id:_("#rama_chart").data("chartData").struc_id,chain:a,min:t,max:t})}),_("#rama_chart").tooltip({selector:"[id^=rama]"})}(jQuery);