function showOutlierRanges(t,r){var e,s={};if(0<t.length){for(let e=0;e<t.length;e++)t[e].frmChn==t[e].toChn&&(null==s[t[e].frmChn]&&(s[t[e].frmChn]=[]),s[t[e].frmChn].push([t[e].resStart,t[e].resEnd]),5<t[e].resEnd-t[e].resStart)&&(r=!0);if(0<$("#pv:visible",currentWin.document).length){let n=[];for(var i in s){i=selectResidues(i,s[i],struc_id,!0);i&&i.eachResidue(function(e){n.push(e.chain().name()),n.push(e.num())})}0<n.length&&(r&&selectResidues(null,null,struc_id),e=pv_viewer.get(struc_id).structure().residueSelect(function(t){for(let e=0;e<n.length;e+=2)if(t.chain().name()==n[e]&&t.num()==n[e+1])return!0;return!1}),pv_viewer.fitTo(e)),pv_viewer.requestRedraw()}if(0<$("#ngl:visible",currentWin.document).length){selectResidues(null,null,struc_id);let e="";for(chn in s)e=selectResidues(chn,s[chn],struc_id,!0);r&&selectResidues(null,null,struc_id),0<ngl_stage.getComponentsByName(struc_id).list.length&&ngl_stage.getComponentsByName(struc_id).list[0].autoView(e,1e3)}}else resetStructure()}function parseLabel(e){var t,n={chain:e.charAt(0),min:parseInt(e.substring(1)),max:parseInt(e.substring(1)),isDisulfid:!1,secondChain:!1};return-1<e.indexOf("-")&&(t=e.split("-")[1],n.max=parseInt(t.substring(1)),t.charAt(0)!=e.charAt(0)&&(n.secondChain=t.charAt(0)),n.isDisulfid=!0),n}function resize(e){if($(window).width()<751)$("#right-panel").css({position:"relative",left:"",top:"",width:""}),$("#viewerWrapper").height($("#viewerWrapper").width()),$("#left-panel").css({width:""});else{let e=!1,t=!1;"fixed"!=$("#right-panel").css("position")?$(document).scrollTop()>$("#left-panel").position().top-8?e=!0:t=!0:$(document).scrollTop()<$("#left-panel").position().top-8?t=!0:e=!0,e?($("#right-panel").css({position:"fixed",top:"8px",left:$("#left-panel").width()+32,width:$("#main-content").innerWidth()-$("#left-panel").width()-48}),$("#viewerWrapper").height(window.innerHeight-$("#viewerWrapper").position().top-50)):t&&($("#right-panel").css({position:"relative",left:"",top:"",width:""}),$("#viewerWrapper").height(window.innerHeight-$("#right-panel").position().top-$("#viewerWrapper").position().top+$(document).scrollTop()-32))}$("#annotate").height($("#viewerWrapper").height()/4).width($("#viewerWrapper").width()-30),$("#pv").height($("#viewerWrapper").height()),0<$("#pv:visible",currentWin.document).length?pv_viewer.fitParent():ngl_stage&&ngl_stage.handleResize(),e&&"resize"!=e.type||($(".alignTbl").alignment("resizeToParent"),updateQmeanCharts(!0),showRamachandran())}chainMapping.annotations=chainMapping.annotations.concat([{key:"clashes",label:"Clashes",active:!0},{key:"bond_angles",label:"Bad Angles",active:!0},{key:"bond_lengths",label:"Bad Bonds",active:!0},{key:"cbeta",label:"CBeta",active:!0},{key:"omega_cis_nonpro",label:"CisNonPro",active:!0},{key:"omega_cis_pro",label:"CisPro",active:!0},{key:"omega_twisted_nonpro",label:"TwistedNonPro",active:!0},{key:"omega_twisted_pro",label:"TwistedPro",active:!0},{key:"ramachandran",label:"Ramachandran",active:!0},{key:"rotamers",label:"Rotamers",active:!0},{key:"lddt",label:"lDDT",active:!0}]),$(".togglePanel").on("click",function(){var e=$(this).find("i");e.hasClass("glyphicon-chevron-up")?(e.removeClass("glyphicon-chevron-up"),e.addClass("glyphicon-chevron-down")):(e.removeClass("glyphicon-chevron-down"),e.addClass("glyphicon-chevron-up")),e.parent().next().toggle()}).css({cursor:"pointer"}).find("i").css({opacity:.6}),$(".outlierLabel input:checkbox").on("click",function(){var e=$(".outlierLabel input:checked");let l=[];0<e.length?($(".outlierLabel input:checked").each(function(){var e,t=$(this).attr("id");for(e in modelData){var n=t.startsWith("lddt")?t.substring(4,t.length-2).toLowerCase():t.substring(0,t.length-2),r=(t.startsWith("lddt")?modelData[e].reference_scores.lddt:modelData[e].molprobity_results).outliers[n],s=chainMapping.structures["model_"+e];if(r.residues)for(let e=0;e<r.residues.length;e++){var i=parseLabel(r.residues[e].name);s[i.chain]&&(s[i.chain][i.min][n]=r.residues[e].title),s[i.secondChain||i.chain]&&(s[i.secondChain||i.chain][i.max][n]=r.residues[e].title)}else for(let e=0;e<r.length;e++)s[r[e][0]][r[e][1]][n]=r[e][3]}$(this).closest("td").siblings().find("span.outlier").each(function(){var e=parseLabel($(this).text());l.push({toChn:e.chain,frmChn:e.chain,upStart:e.min,upEnd:e.min,resStart:e.min,resEnd:e.min,rgb:"240,40,40"}),e.min!=e.max&&l.push({toChn:e.secondChain||e.chain,frmChn:e.secondChain||e.chain,upStart:e.max,upEnd:e.max,resStart:e.max,resEnd:e.max,rgb:"240,40,40"})})}),$(".alignTbl:first").alignment("colourAllAlignments",{features:{["model_"+model_id]:l}})):$(".alignTbl:first").alignment("colourAllAlignments",{}),showOutlierRanges(l)}),$("#chainSelector").multiselect({buttonClass:"btn-sm btn-default btn",onChange:function(e,t){let n="";$("#chainSelector option:selected").each(function(){n+=$(this).val()}),showRamachandran(null,model_id,n)}}),$(document).ready(function(){resize("init"),loadModel(model_id,!0),$('[data-toggle="popover"]').popover(),$(".outlier").on("mouseover",function(){var e=$(this).text(),t=parseInt(e.substring(1));$("body").trigger("highlightResidue",{src:"outlier",struc_id:"model_"+model_id,chain:e.charAt(0),resno:t}),-1<e.indexOf("-")&&(t=parseInt(e.split("-")[1].substring(1)),$("body").trigger("highlightResidue",{src:"outlier",struc_id:"model_"+model_id,chain:e.split("-")[1].charAt(0),resno:t,multiple:!0}))}).on("click",function(){var e=parseLabel($(this).text());$("body").trigger("centerResRange",{src:"outlier",struc_id:"model_"+model_id,chain:e.chain,secondChain:e.secondChain,min:e.min,max:e.max,isDisulfid:e.isDisulfid})}),$(".mdlChnSelect,.refChnSelect").on("mouseover",function(e){var t,n=$(this).text(),r=$(this).hasClass("mdlChnSelect");0<$(".mdlRefSelected").length||!r&&0===$("#showReference:checked").length||(t=r?chainMapping.structures["model_"+model_id][n].filter(e=>0<e.resno).map(e=>e.resno):chainMapping.structures.reference[n].filter(e=>0<e.resno).map(e=>e.resno),$(".alignTbl:first").alignment("colourAllAlignments",{features:{[r?"model_"+model_id:"reference"]:[{toChn:n,frmChn:n,upStart:Math.min(...t),upEnd:Math.max(...t),resStart:Math.min(...t),resEnd:Math.max(...t),rgb:"40,40,140"}]}}))}).on("mouseout",function(){0==$(".mdlRefSelected").length&&$(".alignTbl:first").alignment("colourAllAlignments",{})}).on("click",function(){var e,t=$(this).text(),n=$(this).hasClass("mdlChnSelect");$(".mdlRefSelected").is($(this))?(showOutlierRanges([]),$(".mdlRefSelected").removeClass("mdlRefSelected")):(n||0!==$("#showReference:checked").length||($("#showReference").prop("checked",!0),toggleReference()),e=n?chainMapping.structures["model_"+model_id][t].filter(e=>0<e.resno).map(e=>e.resno):chainMapping.structures.reference[t].filter(e=>0<e.resno).map(e=>e.resno),t=[{toChn:t,frmChn:t,upStart:Math.min(...e),upEnd:Math.max(...e),resStart:Math.min(...e),resEnd:Math.max(...e),rgb:"40,40,140"}],$(".mdlRefSelected").is($(this))||$(".alignTbl:first").alignment("colourAllAlignments",{features:{[n?"model_"+model_id:"reference"]:t}}),showOutlierRanges(t,!0),$(".mdlRefSelected").removeClass("mdlRefSelected"),$(this).addClass("mdlRefSelected"))}).css({cursor:"pointer"}),$(".dqint").on("mouseover",function(e){var[,e,t]=e.target.getAttribute("id").split("_");if(!(0<$(".mdlRefSelected").length||"ref"===t&&0===$("#showReference:checked").length)){var n,r,s=modelData[model_id].reference_scores.interfaces[parseInt(e)],i=[];for(n of s[t+"_chn1"]["5a"].concat(s[t+"_chn1"]["10a"]))i.push({toChn:s[t+"_chn1"].name,frmChn:s[t+"_chn1"].name,upStart:n,upEnd:n,resStart:n,resEnd:n,rgb:"40,40,140"});for(r of s[t+"_chn2"]["5a"].concat(s[t+"_chn2"]["10a"]))i.push({toChn:s[t+"_chn2"].name,frmChn:s[t+"_chn2"].name,upStart:r,upEnd:r,resStart:r,resEnd:r,rgb:"40,140,40"});$(".alignTbl:first").alignment("colourAllAlignments",{features:{["mdl"===t?"model_"+model_id:"reference"]:i}})}}).on("mouseout",function(){0==$(".mdlRefSelected").length&&$(".alignTbl:first").alignment("colourAllAlignments",{})}).on("click",function(e){var[,e,t]=e.target.getAttribute("id").split("_");if($(".mdlRefSelected").is($(this)))showOutlierRanges([]),$(".mdlRefSelected").removeClass("mdlRefSelected");else{"ref"===t&&0===$("#showReference:checked").length&&($("#showReference").prop("checked",!0),toggleReference());var n,r,s=modelData[model_id].reference_scores.interfaces[parseInt(e)],i=[];for(n of s[t+"_chn1"]["5a"].concat(s[t+"_chn1"]["10a"]))i.push({toChn:s[t+"_chn1"].name,frmChn:s[t+"_chn1"].name,upStart:n,upEnd:n,resStart:n,resEnd:n,rgb:"40,40,140"});for(r of s[t+"_chn2"]["5a"].concat(s[t+"_chn2"]["10a"]))i.push({toChn:s[t+"_chn2"].name,frmChn:s[t+"_chn2"].name,upStart:r,upEnd:r,resStart:r,resEnd:r,rgb:"40,140,40"});$(".mdlRefSelected").is($(this))||$(".alignTbl:first").alignment("colourAllAlignments",{features:{["mdl"===t?"model_"+model_id:"reference"]:i}}),showOutlierRanges(i,!0),$(".mdlRefSelected").removeClass("mdlRefSelected"),$(this).addClass("mdlRefSelected")}}).css({cursor:"pointer"})}),$(window).on("resize",function(e){clearTimeout(this.id),this.id=setTimeout(function(){resize(e)},350)}),$(document).on("scroll",function(e){clearTimeout(this.id),this.id=setTimeout(function(){resize(e)},250)});let resizeBarTouch;function showViewer(e){e?$.cookie("defaultViewer",e,{expires:365,path:"/"}):e=$.cookie("defaultViewer")?$.cookie("defaultViewer"):"NGL",$("#pv_status,#ngl_status").text(""),"PV"==e?showPV():"NGL"==e&&showNGL()}function showNGL(){var e=modelData[model_id].superpose?comparisonURL.replace("00","sa_"+project_id+"_"+model_id)+"?t="+modelData[model_id].superpose.mdlTransform.join(",")+(modelData[model_id].membrane_no_transform?"&m="+JSON.stringify(modelData[model_id].membrane_no_transform):""):coordsURL.replace(/00(?=\.pdb)/,model_id);$("#pv,.notNGL").hide(),$("#ngl,.notPV").show(),loadModelNGL(model_id,e),toggleReference()}function showPV(){var e=modelData[model_id].superpose?comparisonURL.replace("00","sa_"+project_id+"_"+model_id)+"?t="+modelData[model_id].superpose.mdlTransform.join(",")+(modelData[model_id].membrane_no_transform?"&m="+JSON.stringify(modelData[model_id].membrane_no_transform):""):coordsURL.replace(/00(?=\.pdb)/,model_id);$("#ngl,.notPV").hide(),$("#pv,.notNGL").show(),loadModelPV(model_id,e),toggleReference()}function loadModel(e,t){loadAlignment(e),updateQmeanCharts();let n="";$("#chainSelector option:selected").each(function(){n+=$(this).val()}),showRamachandran("general",e,n),t&&showViewer()}function toggleMappedChains(){0<$("#pv:visible",currentWin.document).length&&(renderPV(model_id),1==$("#showReference:checked").length)&&renderPV("reference"),0<$("#ngl:visible",currentWin.document).length&&(renderNGL(model_id),1==$("#showReference:checked").length)&&renderNGL("reference")}function loadAlignment(l){if(modelData[l].targets){var o=[],a=[],d=($("#alignDivs").empty(),!modelData[l].keySeqAdjusted);modelData[l].keySeqAdjusted=!0;for(let t=0;t<modelData[l].targets.length;t++){var c,u=modelData[l].targets[t];let e=u.keyseq_chain_name;for(c of e="string"==typeof e?u.keyseq_chain_name.split(""):e){var h=[];let t=modelData[l].residues,n=(u.is_nucleotide&&(t=modelData[l].nucleotides),""),r=[],s=0;for(s=0;s<t.length&&t[s][0]!=c;s++);for(let e=s;e<t.length&&t[e][0]==c;e++)r[e]=t[e][1],n+=t[e][2];r=r.slice(s,n.length+s);let e=u.keyseq_annotation?u.keyseq_annotation[c]:{},i=(d&&1<u.templates[0].trg_offset&&u.keyseq_annotation&&u.keyseq_annotation[c]&&(e=adjustKeyseqAnno(u.keyseq_annotation[c],r),u.keyseq_annotation[c]=e),h.push({struc_id:"model_"+model_id+(u.is_nucleotide?".dna":""),qname:"Chain: "+c,selected:!0,chain:c,trg_seq:n,tpl_seq:n,annotation:e,pdb_res_num:r}),a.push([]),1!==$("#showDSSP:checked").length||u.is_nucleotide||a[a.length-1].push("dssp"),addRefTpl(c,h,r,u.is_nucleotide)&&1===$("#showLDDT:checked").length&&a[a.length-1].push("lddt"),e.qmean&&1===$("#showQMEAN:checked").length&&!u.is_nucleotide&&a[a.length-1].push("qm"),a[a.length-1]=0<a[a.length-1].length&&a[a.length-1].join("|"),u.templates[0].tpl_seq&&addModellingTemplate(h,u.templates[0],r),!1);for(let e=1;!i&&e<h.length;e++)h[e].trg_seq!=h[0].trg_seq&&(i=!0);if(i){let n=h[0].trg_seq.split("");for(let t=1;t<h.length;t++)for(let e=0;e<n.length;e++)n[e]!=h[t].trg_seq[e]&&(n[e]="-"==h[t].trg_seq[e]?"-":"X");n=n.join("");for(let e=0;e<h.length;e++)h[e].trg_seq=n}o.push({templateData:{type:"target-template",target_name:"Consensus",templates:h},qname:"QNAME",charts:a[a.length-1],pageResidueCount:modelData[model_id].residues.length,cols:$.cookie("mdl_cols")?$.cookie("mdl_cols"):50,resetColourCycle:!0}),u.is_nucleotide&&(o[o.length-1].templateData.is_nucleotide=!0)}}for(let e=0;e<o.length;e++)$("#alignDivs").append($("#blankAlignment").html().replace(/TEMPLATE/g,e)),a[e]?"dssp"===a[e]?$(`#alignTbl${e},#alignNameTbl`+e).addClass("secstrucChart"):$(`#alignTbl${e},#alignNameTbl`+e).addClass("hasChart"):$(`#alignTbl${e},#alignNameTbl`+e).removeClass("hasChart,secstrucChart"),$("#alignTbl"+e).alignment(o[e]);addSettingsPopover(),"features"===chainMapping.defaultColourScheme&&processAnnotations()}}function adjustKeyseqAnno(t,n){var e,r={};for(e of Object.keys(t))"string"==typeof t[e]?r[e]="":r[e]=[];let s=0;for(let e=0;e<n.length;e++){var i,l=n[e]-s;for(i of Object.keys(t))"string"==typeof t[i]?r[i]+=(1<l?Array(l).join("-"):"")+t[i][e]:(1<l&&(r[i]=r[i].concat(new Array(l-1))),r[i].push(t[i][e]));s=n[e]}return r}function addModellingTemplate(t,n){let r="",s="";var i=[];let l=n.offset,o=n.trg_offset||1;for(let e=0;e<n.trg_seq.length;e++)"-"!=n.tpl_seq[e]&&l++,"-"!=n.trg_seq[e]&&(-1<t[t.length-1].pdb_res_num.indexOf(o)&&(s+=n.trg_seq[e],r+=n.tpl_seq[e],i.push(l)),o++);t.push({qname:n.qname,selected:!0,chain:n.chain,trg_seq:s,tpl_seq:r,pdb_res_num:i})}function addRefTpl(s,e,i,t){if(!modelData[model_id].reference_scores)return!1;let n=!1;for(var l of modelData[model_id].reference_scores.lddt.aligned_chains)if(l.model.chain===s){var o=e[e.length-1].struc_id;let r="";var a=[];for(let n=0;n<i.length;n++){let t=!1;for(let e=0;e<l.model.residues.length;e++)if(null!==l.model.residues[e]&&l.model.residues[e].num===i[n]){t=!0,null!==l.reference.residues[e]?(chainMapping.structures[o]||(chainMapping.structures[o]={}),chainMapping.structures[o][s]||(chainMapping.structures[o][s]=[]),chainMapping.structures[o][s][i[n]]?chainMapping.structures[o][s][i[n]].lddt=l.model.residues[e].lddt:chainMapping.structures[o][s][i[n]]={chn:s,resno:l.model.residues[e].num,resname:l.model.residues[e].olc,trgno:l.model.residues[e].num,trgname:l.model.residues[e].olc,lddt:l.model.residues[e].lddt},r+=l.reference.residues[e].olc,a.push(l.reference.residues[e].num)):(a.push(null),r+="-");break}t||(r+="-",a.push(null))}e.push({struc_id:"reference"+(t?".dna":""),qname:"Reference: "+l.reference.chain,selected:!0,chain:l.reference.chain,trg_seq:r,tpl_seq:r,pdb_res_num:a}),n=!0}return n}function getFileName(){var e=$("#rama_chart").data().chartData;return e.struc_id+"_"+e.chartType+"_"+e.chain+".png"}$("#left-panel").resizable({handles:"e",stop:function(){}}),$(".ui-resizable-e")[0].addEventListener("touchstart",e=>{const t=e=>{e.preventDefault(),1==e.touches.length&&Math.abs(e.touches[0].pageX-resizeBarTouch.x)&&($("#left-panel").width($("#left-panel").width()+e.touches[0].pageX-resizeBarTouch.x),resizeBarTouch.x=e.touches[0].pageX)},n=()=>{e.target.removeEventListener("touchmove",t),e.target.removeEventListener("touchend",n),resizeBarTouch=null,this.id=setTimeout(function(){resize()},250)};e.target.addEventListener("touchmove",t),e.target.addEventListener("touchend",n),1==e.touches.length&&(resizeBarTouch={x:e.touches[0].pageX})});let lastSelectResidue=null;function superpose(){let e=[],s,i;var t,n;$(".alignTbl").each(function(){if(2<(e=$(this).find("span.selectResidue")).length)return s=$(this),i=e.closest("tr").attr("struc_id"),!1}),e.length<3||($("#showReference").prop("checked",!0),t=e.first().closest("tr").attr("seqno"),t=(n=s.find("tr[seqno]")).filter("[seqno="+t+"]").find("span"),n=[{ref_seq:!i.startsWith("reference"),model_id:`sa_${project_id}_`+model_id,chain:n.filter("tr[seqno=2]:first").attr("chain"),residues:n.filter(`[struc_id=model_${model_id}]`).find("td:even").text(),first_resnum:n.filter(`[struc_id=model_${model_id}]`).find("span[s]:first").attr("s")},{ref_seq:i.startsWith("reference"),model_id:"sa_"+project_id+"_ref"+model_id,chain:n.filter("[seqno=3]:first").attr("chain"),residues:n.filter("[struc_id=reference]").find("td:even").text(),first_resnum:n.filter("tr[struc_id=reference]").find("span[s]:first").attr("s")}],modelData[model_id].membrane_no_transform&&(n[0].membrane=modelData[model_id].membrane_no_transform),$("#superposeError").html(""),$("#superposeBtn").prop("disabled",!0),$.ajax({type:"POST",url:superposeURL,data:{models:JSON.stringify(n),from:t.index(e.first()),to:t.index(e.last()),csrfmiddlewaretoken:csrf},dataType:"json",success:function(t){let n=0;modelData[model_id].superpose={};for(let e=0;e<t.results.superposed.length;e++){var r=t.results.superposed[e].model_id.endsWith("_ref"+model_id);t.results.superposed[e].ref_idx&&(modelData[model_id].superpose.ref=i,modelData[model_id].superpose.chain=t.results.superposed[e].chain,modelData[model_id].superpose.from=s.data("templateData").templates[r?1:0].pdb_res_num[t.results.superposed[e].from],modelData[model_id].superpose.to=s.data("templateData").templates[r?1:0].pdb_res_num[t.results.superposed[e].to+1]),r?modelData[model_id].superpose.refTransform=t.results.superposed[e].transform:modelData[model_id].superpose.mdlTransform=t.results.superposed[e].transform,t.results.superposed[e].membrane&&(membraneData["model_"+model_id]=t.results.superposed[e].membrane)}for(let e=0;e<t.results.superposed.length;e++)t.results.superposed[e].rmsd||n++;0<n&&(delete modelData[model_id].superpose,$("#superposeError").html("Failed to superpose on selected residues!")),ngl_stage&&ngl_stage.eachComponent(function(e){ngl_stage.removeComponent(e)}),showViewer()},error:function(e){var r=e.responseJSON;if(429==e.status)$("#superposeError").html("Too many requests - retry after "+r.retryAfter+" s"),clearTimeout(this.id),this.id=setTimeout(function(){$("#superposeBtn").prop("disabled",!1),$("#superposeError").html("")},parseInt(1e3*r.retryAfter));else if(r){let n=e.responseJSON.error;if(r.invalid){for(let t=0;t<r.invalid.length;t++)for(let e=0;e<data.length;e++)data[e].model_id==r.invalid[t]&&(n+="<br>Model "+data[e].label+" could not be found!");$("#superposeError").html(n)}}else $("#superposeError").html("Server error")}}))}function toggleReference(){let e=modelData[model_id].superpose?comparisonURL.replace("00","sa_"+project_id+"_ref"+model_id)+"?t="+modelData[model_id].superpose.refTransform.join(",")+(modelData[model_id].membrane_no_transform?"&m="+JSON.stringify(modelData[model_id].membrane_no_transform):""):refCoordsURL.replace(/00(?=\/ref)/,model_id);e=e.replace(".cif",".pdb");var n=1==$("#showReference:checked").length;if(n?$("#refOpacity").slider("option","disabled",!1):$("#refOpacity").slider("option","disabled",!0),0<$("#pv:visible",currentWin.document).length)pv_viewer.rm("reference*"),n?loadModelPV("reference",e):pv_viewer.autoZoom();else if(0<$("#ngl:visible",currentWin.document).length){let t=[];ngl_stage.compList.forEach(function(e){0==e.name.indexOf("reference")&&t.push(e)});for(var r of t)ngl_stage.removeComponent(r);n&&loadModelNGL("reference",e)}}$("body").on("highlightResidue",function(e,t){if("structure"===t.src&&modelData[model_id].reference_scores&&t.struc_id){let e;0<$("#ngl:visible",currentWin.document).length&&(e="#ngl_status:visible"),0<$("#pv:visible",currentWin.document).length&&(e="#pv_status:visible"),$(e).html(("reference"===t.struc_id?"Reference: ":"Model: ")+$(e).html())}var n;"alignment"===t.src&&((t=$(".alignTbl .selectResidue")).length<3?$("#superposeBtn").prop("disabled")||$("#superposeBtn").prop("disabled",!0):(n=[(n=t.closest("tr")).attr("struc_id"),n.attr("chain"),t.first().attr("s"),t.last().attr("s")].join(" "),lastSelectResidue!=n&&$("#superposeBtn").prop("disabled",!1),lastSelectResidue=n))}),$("#refOpacity").slider({value:100,min:0,max:100,step:1,disabled:!0,slide:function(e,t){let n="reference",r=t.value/100;0<$("#pv:visible",currentWin.document).length&&(pv_viewer.forEach(function(e){0==e.name().indexOf(n)&&(e.setOpacity(r),e.order(10-10*r))}),pv_viewer._objects.sort(function(e,t){return e.order()-t.order()}),pv_viewer.requestRedraw()),0<$("#ngl:visible",currentWin.document).length&&ngl_stage.eachRepresentation(function(e){e.name.startsWith(n)&&e.repr.setParameters({opacity:r})})}});